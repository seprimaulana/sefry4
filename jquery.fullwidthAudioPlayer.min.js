/*
* Fullwidth Audio Player V1.5.1
* Author: Rafael Dery
* Copyright 2011
*
* Only for the sale at the envato marketplaces
*
*/

(function(e){e.fullwidthAudioPlayer={version:"1.5",author:"Rafael Dery"};jQuery.fn.fullwidthAudioPlayer=function(G){function H(b){if(c.storePlaylist&&"undefined"==typeof amplify)return alert("Please include the amplify.min.js file in your document!"),!1;m=e(b);m.hide();P="fap-popup"==b.id;if(v()){if(c.hideOnMobile)return!1;c.autoPlay=c.volume=c.playlist=!1;c.wrapperPosition="top"}k=Boolean(window.fapPopupWin);c.autoPopup||(k=!0);d=!c.autoPlay;E();s=c.playlist?c.height+c.playlistHeight+c.offset:c.height; if("popup"==c.wrapperPosition&&!P)return c.layout="fullwidth",I=!0,c.playlist||(s=c.height),c.autoPopup&&!window.fapPopupWin&&F(m.html(),c.autoPlay),!1;b='<div id="fap-wrapper" class="'+("top"==c.wrapperPosition?"fap-wrapper-top":"fap-wrapper-bottom")+'" style="'+c.wrapperPosition+": 0; height: "+s+'px;"><div id="fap-main" style="color:'+c.mainColor+';"><div id="fap-wrapper-switcher" style="background: '+c.wrapperColor+"; border-color: "+c.strokeColor+'"></div><p id="fap-init-text">Creating Playlist...</p></div></div>'; e("body").append(b);r=e("body").children("#fap-wrapper");l=r.children("#fap-main");"fullwidth"==c.layout?r.addClass("fap-fullwidth").css({background:c.wrapperColor,borderColor:c.strokeColor}):"boxed"==c.layout&&(r.addClass("fap-boxed"),l.css({background:c.wrapperColor,borderColor:c.strokeColor}));P&&r.addClass("fap-popup-skin");v()&&r.css({position:"absolute"});P?l.css({marginLeft:10,marginRight:10}):"center"==c.mainPosition?l.css({marginLeft:"auto",marginRight:"auto"}):"right"==c.mainPosition?l.css({"float":"right", marginRight:10}):l.css({marginLeft:10});"top"==c.wrapperPosition?l.children("#fap-wrapper-switcher").addClass("fap-bordered-bottom").css({bottom:-16,borderTop:"none"}):l.children("#fap-wrapper-switcher").addClass("fap-bordered-top").css({top:-16,borderBottom:"none"});c.opened?e.fullwidthAudioPlayer.setPlayerPosition("open",!1):e.fullwidthAudioPlayer.setPlayerPosition("close",!1);l.children("#fap-wrapper-switcher").click(function(){c.opened?e.fullwidthAudioPlayer.setPlayerPosition("close",!0):e.fullwidthAudioPlayer.setPlayerPosition("open", !0)});if(window.SC)SC.initialize({client_id:"LFSDttxBaGVSYZfSitrA"}),SC.whenStreamingReady(N);else soundManager.onready(N)}function F(b,d){if(!window.fapPopupWin||window.fapPopupWin.closed){var f=(window.screen.width-980)/2,g=(window.screen.height-s)/2,h=/Chrome/i.test(navigator.userAgent);window.fapPopupWin=window.open(c.popupUrl,"","menubar=no,toolbar=no,location=yes,status=no,width=980,height="+(h?s+30:s)+",left="+f+",top="+g+"");null==window.fapPopupWin&&alert("Pop-Up Music Player can not be opened. Your browser is blocking Pop-Ups. Please allow Pop-Ups for this site to use the Music Player."); e(window.fapPopupWin).load(function(){e(window.fapPopupWin).animate({innerHeight:s},500);e('.fap-single-track[data-autoenqueue="yes"]').each(function(d,c){var k=e(c);b+=y(k)});c.autoPlay=d;window.fapPopupWin.initPlayer(c,b);k=!0})}else f=e(b),e.fullwidthAudioPlayer.addTrack(f.attr("href"),f.attr("title"),f.data("meta")?e("body").find(f.data("meta")).html():"",f.attr("rel"),f.attr("target"),d)}function N(){c.playlist&&(n=e('<ul id="fap-playlist"></ul>').css("height",c.playlistHeight));c.xmlPath?e.ajax({type:"GET", url:c.xmlPath,dataType:"xml",cache:!1,success:function(b){var d=e(b).find("playlists");b=c.xmlPlaylist?b=c.xmlPlaylist:b=d.children("playlist:first").attr("id");z(d.children('playlist[id="'+b+'"]').children("track"));e(".fap-xml-playlist").each(function(b,c){var k=e(c);k.append("<h3>"+c.title+'</h3><ul class="fap-my-playlist"></ul>');d.children('playlist[id="'+c.id+'"]').children("track").each(function(b,d){var f=e(d),W=f.attr("target")?'target="'+f.attr("target")+'"':"",g=f.attr("rel")?'rel="'+f.attr("rel")+ '"':"",Z=f.find("meta")?'data-meta="#'+c.id+"-"+b+'"':"";k.children("ul").append('<li><a href="'+f.attr("href")+'" title="'+f.attr("title")+'" '+W+" "+g+" "+Z+">"+f.attr("title")+"</a></li>");k.append('<span id="'+c.id+"-"+b+'">'+f.find("meta").text()+"</span>")})})},error:function(){alert("XML file could not be loaded. Please check the XML path!")}}):z(m.children("a"))}function z(b){if(c.storePlaylist)var d=Boolean(amplify.store("fap-playlist"));b=d?JSON.parse(amplify.store("fap-playlist")):b;m.bind("fap-tracks-stored", function(){++K;if(K<b.length)if(c.storePlaylist&&d){var k=b[K];e.fullwidthAudioPlayer.addTrack(k.stream_url,k.title,k.meta,k.artwork_url,k.permalink_url,c.autoPlay)}else k=b.eq(K),e.fullwidthAudioPlayer.addTrack(k.attr("href"),k.attr("title"),c.xmlPath?k.children("meta").text():m.find(k.data("meta")).html(),k.attr("rel"),k.attr("target"),c.autoPlay);else m.unbind("fap-tracks-stored"),c.randomize&&U(),J()}).trigger("fap-tracks-stored")}function J(){l.children("p").remove();l.append('<div id="fap-meta-wrapper" class="clearfix"><img src="" id="fap-current-cover" style="width: '+ c.coverSize[0]+"px; height:"+c.coverSize[1]+"px; border: 1px solid "+c.strokeColor+';" /><div id="fap-cover-replacement" style="width: '+c.coverSize[0]+"px; height:"+c.coverSize[1]+"px; border: 1px solid "+c.strokeColor+';"></div><p id="fap-current-title" style="color: '+c.mainColor+';"></p><p id="fap-current-meta" style="color: '+c.metaColor+';"></p></div>');b=l.children("#fap-meta-wrapper").css("height",c.height-10);w(document.getElementById("fap-cover-replacement"),c.coverSize[0],c.coverSize[1]); c.socials&&b.append('<p id="fap-social-links"><a href="" target="_blank" style="color: '+c.metaColor+';">'+c.facebookText+'</a><a href="" target="_blank" style="color: '+c.metaColor+';">'+c.twitterText+'</a><a href="" target="_blank" style="color: '+c.metaColor+';">'+c.downloadText+'</a><a href="" target="_blank" class="fap-soundcloud-link"></a></p>');t=l.append('<div id="fap-ui-wrapper"></div>').children("#fap-ui-wrapper").css("height",c.height);var d=t.append('<div id="fap-ui-nav"></div>').children("#fap-ui-nav"); d.css("margin-top",0.5*c.height-0.5*d.height());d.append('<a href="#" id="fap-previous" style="background-color: '+c.fillColor+';"></a>').children("#fap-previous").click(function(){e.fullwidthAudioPlayer.previous();return!1});d.append('<a href="#" id="fap-play-pause" style="background-color: '+c.fillColor+';"></a>').children("#fap-play-pause").click(function(){e.fullwidthAudioPlayer.toggle();return!1});d.append('<a href="#" id="fap-next" style="background-color: '+c.fillColor+';"></a>').children("#fap-next").click(function(){e.fullwidthAudioPlayer.next(); return!1});t.children("div:first").length&&(t.width(),t.children("div:first").position());t.append('<div id="fap-time-bar" class="clearfix" style="width: '+V+"px; border: 1px solid "+c.fillColor+"; margin-top: "+(0.5*c.height-3)+"px; color: "+c.metaColor+';"><div id="fap-loading-bar" style="background: '+c.fillColor+';"></div><div id="fap-progress-bar" style="background: '+c.mainColor+';"></div><span id="fap-current-time">00:00:00</span><span id="fap-total-time">00:00:00</span></div>');t.find("#fap-loading-bar, #fap-progress-bar").click(function(b){b= (b.pageX-e(this).parent().offset().left)/V;h.setPosition(b*h.duration);p(b)});c.volume&&(t.append('<div id="fap-volume-bar" style="width: '+g+"px; background: "+c.fillColor+"; border: 1px solid "+c.fillColor+"; margin-top: "+(0.5*c.height-3)+'px;"><div id="fap-volume-progress" style="background: '+c.mainColor+';"></div></div><div id="fap-volume-sign"></div>'),t.children("#fap-volume-sign").css("margin-top",0.5*c.height-0.5*t.children("#fap-volume-sign").height()),t.find("#fap-volume-bar").click(function(b){b= (b.pageX-e(this).offset().left)/g;e.fullwidthAudioPlayer.volume(b)}));if(c.playlist){"bottom"==c.wrapperPosition?(l.append('<div class="clear"></div>').append(n),n.css({marginTop:c.offset})):(l.prepend('<div class="clear"></div>').prepend(n),n.css({marginBottom:c.offset}));n.niceScroll({cursorcolor:c.mainColor,cursorborder:"none",autohidemode:!1});n.getNiceScroll().hide();e(".nicescroll-rails").hover(function(){n.getNiceScroll().resize().show()},function(){n.getNiceScroll().resize().hide()});n.hover(function(){n.getNiceScroll().resize().show()}, function(){n.getNiceScroll().resize().hide()});if(c.sortable){var X;n.sortable().bind("sortstart",function(b,d){d.item.addClass("fap-prevent-click");X=n.children("li").index(d.item)});n.sortable().bind("sortupdate",function(b,d){var k=n.children("li").index(d.item),O=q[X],f=q[u].title;q.splice(X,1);q.splice(k,0,O);Q(f);c.storePlaylist&&amplify.store("fap-playlist",JSON.stringify(q))})}P?e.fullwidthAudioPlayer.setPlayerPosition("openPlaylist",!1):(t.append('<a href="#" id="fap-playlist-toggle" style="background-color:'+ c.fillColor+"; margin-top: "+(0.5*c.height-12)+'px;"></a>'),t.children("#fap-playlist-toggle").click(function(){f?e.fullwidthAudioPlayer.setPlayerPosition("closePlaylist",!0):e.fullwidthAudioPlayer.setPlayerPosition("openPlaylist",!0);return!1}))}c.shuffle&&(t.append('<a href="#" id="fap-playlist-shuffle" style="background-color:'+c.fillColor+"; margin-top: "+(0.5*c.height-12)+'px;"></a>'),t.children("#fap-playlist-shuffle").click(function(){U();return!1}));t.find("a").hover(function(){e(this).css("backgroundColor", c.fillColorHover)},function(){e(this).css("backgroundColor",c.fillColor)});c.keyboard&&e(document).keyup(function(b){switch(b.which){case 32:e.fullwidthAudioPlayer.toggle();break;case 39:e.fullwidthAudioPlayer.next();break;case 37:e.fullwidthAudioPlayer.previous();break;case 38:e.fullwidthAudioPlayer.volume(R/100+0.05);break;case 40:e.fullwidthAudioPlayer.volume(R/100-0.05)}});b.children("p").css("marginLeft",c.coverSize[0]+10);m.trigger("onFapReady");k=!0;e('.fap-single-track[data-autoenqueue="yes"]').each(function(b, d){var c=e(d);jQuery.fullwidthAudioPlayer.addTrack(c.attr("href"),c.attr("title"),e("body").find(c.data("meta")).html(),c.attr("rel"),c.attr("target"),!1)});m.bind("fap-tracks-stored",function(b,d){S&&e.fullwidthAudioPlayer.selectTrack(d,S)});e.fullwidthAudioPlayer.selectTrack(0,/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)?!1:c.autoPlay);c.autoPlay?m.trigger("onFapPlay"):m.trigger("onFapPause")}function E(){function b(){if(!k)return!1;var d=e(this),c=!0;d.data("enqueue")&& (c="yes"==d.data("enqueue")?!1:!0);if(I)if(d.hasClass("fap-add-playlist")){var d=d.data("playlist"),f=jQuery('ul[data-playlist="'+d+'"]').first().children("li").find(".fap-single-track"),d=y(e(f.get(0)));if(0==f.size())return!1;F(d,c);f.splice(0,1);window.fapReady=void 0!=window.fapPopupWin.addTrack;var W=setInterval(function(){window.fapReady&&(clearInterval(W),f.each(function(b,d){F(d,c)}))},50)}else d=y(d),F(d,c);else if(d.hasClass("fap-add-playlist")){d=d.data("playlist");f=jQuery('ul[data-playlist="'+ d+'"]').first().children("li").find(".fap-single-track");if(0==f.size())return!1;K=-1;m.bind("fap-tracks-stored",function(){++K;if(K<f.size()){var b=f.eq(K);e.fullwidthAudioPlayer.addTrack(b.attr("href"),b.attr("title"),e("body").find(b.data("meta")).html(),b.attr("rel"),b.attr("target"),0==K&&c)}else m.unbind("fap-tracks-stored")}).trigger("fap-tracks-stored")}else e.fullwidthAudioPlayer.addTrack(d.attr("href"),d.attr("title"),e("body").find(d.data("meta")).html(),d.attr("rel"),d.attr("target"), c);return!1}"1.7"<=m.jquery?(e("body").on("click",".fap-my-playlist li a, .fap-single-track",b),e("body").on("click",".fap-add-playlist",b)):(e("body").delegate(".fap-my-playlist li a, .fap-single-track","click",b),e("body").delegate(".fap-add-playlist","click",b))}function y(b){var d='<a href="'+b.attr("href")+'" title="'+(b.attr("title")?b.attr("title"):"")+'" target="'+(b.attr("target")?b.attr("target"):"")+'" rel="'+(b.attr("rel")?b.attr("rel"):"")+'" data-meta="'+(b.data("meta")?b.data("meta"): "")+'"></a>';if(b.data("meta"))var c=e("body").find(b.data("meta")).html()?e("body").find(b.data("meta")).html():"",d=d+('<span id="'+b.data("meta").substring(1)+'">'+c+"</span>");return d}function L(b){if(/http(s?):\/\/soundcloud/.test(b))b=b.replace("/likes","/favorites"),SC.get("/resolve",{url:b},function(d,c){if(c&&c.message)return alert(c.message+"\n"+b),!1;var k=-1,f=-1;if(e.isArray(d))for(var g=0;g<d.length;++g)f=B(d[g]),k=f<k?f:k,0==g&&(k=f);else if("playlist"==d.kind)for(g=0;g<d.tracks.length;++g)f= B(d.tracks[g]),k=f<k?f:k,0==g&&(k=f);else"user"==d.kind?SC.get("/users/"+d.id+"/tracks",function(b,d){for(var c=0;c<b.length;++c)f=B(b[c]),k=f<k?f:k,0==c&&(k=f);m.trigger("onFapTracksAdded",[q]);m.trigger("fap-tracks-stored",[k])}):"group"==d.kind?SC.get("/groups/"+d.id+"/tracks",function(b,d){for(var c=0;c<b.length;++c)f=B(b[c]),k=f<k?f:k,0==c&&(k=f);m.trigger("onFapTracksAdded",[q]);m.trigger("fap-tracks-stored",[k])}):"track"==d.kind&&(k=B(d));0<=k&&(m.trigger("onFapTracksAdded",[q]),m.trigger("fap-tracks-stored", [k]))});else if(/http(s?):\/\/official.fm/.test(b)){var d=b.substr(b.lastIndexOf("/tracks")+8);e.getJSON("http://api.official.fm/tracks/"+d+"?fields=streaming,cover&api_version=2",function(b){b=b.track;b=B({stream_url:b.streaming.http,title:b.artist+" - "+b.title,meta:b.project.name,artwork_url:b.cover.urls.small,permalink_url:b.page});m.trigger("onFapTracksAdded",[q]);m.trigger("fap-tracks-stored",[b])})}}function B(b){for(var d=q.length,k=0;k<q.length;++k)if(b.title==q[k].title)return d=k;q.push(b); C(b.artwork_url,b.title);c.storePlaylist&&amplify.store("fap-playlist",JSON.stringify(q));return d}function x(){t.find("#fap-loading-bar").width(this.bytesLoaded/this.bytesTotal*V)}function A(){var b=this.position,d=this.duration,c=T(b/1E3);Y!=c&&(t.find("#fap-current-time").text(c),t.find("#fap-total-time").text(T(d/1E3)),p(b/d));Y=c}function D(){c.playNextWhenFinished?e.fullwidthAudioPlayer.next():(e.fullwidthAudioPlayer.pause(),h.setPosition(0),p(0))}function M(b){b||window.console&&window.console.log&& console.log("Track could not be loaded! Please check the URL: "+this.url)}function C(b,k){function f(){var b=e(this).parent();b.hasClass("fap-prevent-click")?b.removeClass("fap-prevent-click"):(b=n.children("li").index(b),e.fullwidthAudioPlayer.selectTrack(b,!0))}function g(){var b=e(this),k=b.parent().parent().children("li").index(b.parent());q.splice(k,1);b.parent().remove();k==u?(u--,k=k==q.length?0:k,e.fullwidthAudioPlayer.selectTrack(k,d?!1:!0)):k<u&&u--;n.getNiceScroll().resize();c.storePlaylist&& amplify.store("fap-playlist",JSON.stringify(q))}if(!c.playlist)return!1;n.append('<li class="clearfix">'+(b?'<img src="'+b+'" style="border: 1px solid '+c.strokeColor+';" />':'<div class="fap-cover-replace-small" style="background: '+c.wrapperColor+"; border: 1px solid "+c.strokeColor+';"></div>')+"<span>"+k+'</span><div class="fap-remove-track">&times;</div></li>');var h=n.children("li").last().css({marginBottom:5,height:22});-1==navigator.appVersion.indexOf("MSIE 7.")&&(b||w(h.children(".fap-cover-replace-small").get(0), 20,20));"1.7"<=m.jquery?(h.on("click","span",f),h.on("click",".fap-remove-track",g)):(h.delegate("span","click",f),h.delegate(".fap-remove-track","click",g));n.getNiceScroll().resize()}function w(b,d,k){e(b).append('<span style="line-height: '+k+"px; color: "+c.metaColor+';">&hellip;</span>')}function p(b){t.find("#fap-progress-bar").width(b*V)}function T(b){b=Math.abs(b);var d=[];d[0]=Math.floor(b/3600%24);d[1]=Math.floor(b/60%60);d[2]=Math.floor(b%60);b=!0;for(var c=-1,k=0;k<d.length;k++)10>d[k]&& (d[k]="0"+d[k]),"00"==d[k]&&k<d.length-2&&!b?c=k:b=!0;d.splice(0,c+1);return d.join(":")}function U(){n&&n.empty();if(-1!=u){var b=q[u].title;q.shuffle();Q(b);for(b=0;b<q.length;++b)C(q[b].artwork_url,q[b].title);l.find("#fap-playlist").children("li").eq(u).css("backgroundColor",c.fillColor);l.find("#fap-playlist").scrollTop(0)}else for(q.shuffle(),b=0;b<q.length;++b)C(q[b].artwork_url,q[b].title);c.storePlaylist&&amplify.store("fap-playlist",JSON.stringify(q))}function Q(b){for(var d=0;d<q.length;++d)q[d].title== b&&(u=d)}function v(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}var c=e.extend({},e.fn.fullwidthAudioPlayer.defaults,G),m,r,l,t,b,n=null,h,Y,s=0,K=-1,V=180,g=50,u=-1,R=100,d,k,f=!1,S=!1,I=!1,P=!1,q=[];e.fullwidthAudioPlayer.play=function(){-1==u&&e.fullwidthAudioPlayer.next();0<q.length&&(h.playState?h.resume():h.play(),t.find("#fap-play-pause").removeClass("fap-play").addClass("fap-pause"),d=!1,m.trigger("onFapPlay"))};e.fullwidthAudioPlayer.pause=function(){0<q.length&& (h.pause(),t.find("#fap-play-pause").removeClass("fap-pause").addClass("fap-play"),d=!0,m.trigger("onFapPause"))};e.fullwidthAudioPlayer.toggle=function(){d?e.fullwidthAudioPlayer.play():e.fullwidthAudioPlayer.pause()};e.fullwidthAudioPlayer.previous=function(){0<q.length&&e.fullwidthAudioPlayer.selectTrack(u-1,!0)};e.fullwidthAudioPlayer.next=function(){0<q.length&&e.fullwidthAudioPlayer.selectTrack(u+1,!0)};e.fullwidthAudioPlayer.volume=function(b){0<q.length&&(0>b&&(b=0),1<b&&(b=1),R=100*b,h&& h.setVolume(R),t.find("#fap-volume-progress").width(b*g))};e.fullwidthAudioPlayer.addTrack=function(b,d,k,f,g,O){if(null==b||""==b)return alert('The track with the title "'+d+'" does not contain a track URI to a MP3 file or to a soundcloud resource!'),!1;void 0===d&&(d="");void 0===k&&(k="");void 0===f&&(f="");void 0===g&&(g="");void 0===O&&(O=!1);if(I&&window.fapPopupWin&&!window.fapPopupWin.closed)return window.fapPopupWin.addTrack(b,d,k,f,g,O),window.fapPopupWin.focus(),!1;if(c.base64){var h="", n,v,l,r,t,s=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<b.length;)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(s++)),v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(s++)),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(s++)),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(s++)),n=n<<2|v>>4,v=(v&15)<<4|r>>2,l=(r&3)<<6|t,h+=String.fromCharCode(n), 64!=r&&(h+=String.fromCharCode(v)),64!=t&&(h+=String.fromCharCode(l));s="";for(r=c1=c2=b=0;b<h.length;)r=h.charCodeAt(b),128>r?(s+=String.fromCharCode(r),b++):191<r&&224>r?(c2=h.charCodeAt(b+1),s+=String.fromCharCode((r&31)<<6|c2&63),b+=2):(c2=h.charCodeAt(b+1),c3=h.charCodeAt(b+2),s+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63),b+=3);b=s}S=O;/http(s?):\/\/soundcloud/.test(b)||/http(s?):\/\/official.fm/.test(b)?L(b):(d=B({stream_url:b,title:d,meta:k,artwork_url:f,permalink_url:g}),m.trigger("onFapTracksAdded", [q]),m.trigger("fap-tracks-stored",[d]));c.opened||!O||P||e.fullwidthAudioPlayer.setPlayerPosition("open",!0)};e.fullwidthAudioPlayer.selectTrack=function(k,f){if(0>=q.length)return e.fullwidthAudioPlayer.clear(),!1;if(k==u)return e.fullwidthAudioPlayer.toggle(),!1;0>k?u=q.length-1:k>=q.length?(u=0,f=c.loopPlaylist):u=k;d=!f;var g=/http(s?):\/\/soundcloud/.test(q[u].permalink_url);t.find("#fap-progress-bar").width(0);t.find("#fap-total-time, #fap-current-time").text("00:00:00");b.children("#fap-current-cover").attr("src", q[u].artwork_url);b.children("#fap-current-title").html(q[u].title);b.children("#fap-current-meta").html(g?q[u].genre:q[u].meta);q[u].artwork_url?(b.children("#fap-current-cover").show(),b.children("#fap-cover-replacement").hide()):(b.children("#fap-current-cover").hide(),b.children("#fap-cover-replacement").show());if(q[u].permalink_url){b.children("#fap-social-links").children("a").show();var I="http://www.facebook.com/sharer.php?u="+encodeURIComponent(q[u].permalink_url),S="http://twitter.com/share?url="+ encodeURIComponent(q[u].permalink_url)+"&text="+encodeURIComponent(q[u].title)+"";b.find("#fap-social-links a:eq(0)").attr("href",I);b.find("#fap-social-links a:eq(1)").attr("href",S);b.find("#fap-social-links a:eq(2)").attr("href",q[u].permalink_url+"/download");b.find("#fap-social-links a:eq(3)").attr("href",q[u].permalink_url)}else b.children("#fap-social-links").children("a").hide();n&&(n.children("li").css("background","none"),n.children("li").eq(u).css("background",c.activeTrackColor),n.scrollTop(n.children("li").eq(0).outerHeight(!0)* u));f?t.find("#fap-play-pause").removeClass("fap-play").addClass("fap-pause"):t.find("#fap-play-pause").removeClass("fap-pause").addClass("fap-play");h&&h.destruct();I={id:"fap_sound",autoPlay:f,autoLoad:c.autoLoad,volume:R,whileloading:x,whileplaying:A,onfinish:D,onload:M};g?(b.children("#fap-social-links").children("a:eq(3)").show(),q[u].downloadable?b.children("#fap-social-links").children("a:eq(2)").show():b.children("#fap-social-links").children("a:eq(2)").hide(),SC.stream(q[u].stream_url,I, function(b){b?h=b:alert("Streaming could not be started. Please try again!")})):(b.children("#fap-social-links").children("a:eq(2), a:eq(3)").hide(),e.extend(I,{id:"fap_sound",url:q[u].stream_url}),h=soundManager.createSound(I));m.trigger("onFapTrackSelect",[q[u]])};e.fullwidthAudioPlayer.setPlayerPosition=function(b,d){if(r.is(":animated"))return!1;"open"==b?(l.children("#fap-wrapper-switcher").html("&times;"),"top"==c.wrapperPosition?r.animate({top:-(s-c.height)},d?300:0):r.animate({bottom:-(s- c.height)},d?300:0),c.opened=!0):"close"==b?(l.children("#fap-wrapper-switcher").html("+"),"top"==c.wrapperPosition?r.animate({top:-s-1},d?300:0):r.animate({bottom:-s-1},d?300:0),c.opened=f=!1):"openPlaylist"==b?("top"==c.wrapperPosition?r.animate({top:0},300,function(){n.getNiceScroll().resize().show()}):r.animate({bottom:0},300,function(){n.getNiceScroll().resize().show()}),f=!0):"closePlaylist"==b&&(n.getNiceScroll().hide(),"top"==c.wrapperPosition?r.animate({top:-(s-c.height)},300):r.animate({bottom:-(s- c.height)},300),f=!1)};e.fullwidthAudioPlayer.clear=function(){b.children("#fap-current-cover").hide();b.children("#fap-cover-replacement").show();b.children("#fap-current-title, #fap-current-meta").html("");b.children("#fap-social-links").children("a").attr("href","").hide();t.find("#fap-progress-bar, #fap-loading-bar").width(0);t.find("#fap-current-time, #fap-total-time").text("00:00:00");t.find("#fap-play-pause").removeClass("fap-pause").addClass("fap-play");d=!0;u=-1;n&&n.empty();q=[];h&&h.destruct(); c.playlist&&n.getNiceScroll().resize();m.trigger("onFapClear")};e.fullwidthAudioPlayer.popUp=function(){I&&(!window.fapPopupWin||window.fapPopupWin.closed?F("",!1):window.fapPopupWin.focus())};Array.prototype.shuffle=function(){for(var b,d,c=0;c<this.length;c++)d=Math.floor(Math.random()*this.length),b=this[c],this[c]=this[d],this[d]=b};return this.each(function(){H(this)})};e.fn.fullwidthAudioPlayer.defaults={wrapperPosition:"bottom",mainPosition:"center",wrapperColor:"#f0f0f0",mainColor:"#3c3c3c", fillColor:"#e3e3e3",metaColor:"#666666",strokeColor:"#e0e0e0",fillColorHover:"#d1d1d1",activeTrackColor:"#E8E8E8",twitterText:"Share on Twitter",facebookText:"Share on Facebook",downloadText:"Download",layout:"fullwidth",popupUrl:"popup.html",height:80,playlistHeight:210,coverSize:[65,65],offset:20,opened:!0,volume:!0,playlist:!0,autoLoad:!0,autoPlay:!1,playNextWhenFinished:!0,keyboard:!0,socials:!0,autoPopup:!1,randomize:!1,shuffle:!0,sortable:!1,base64:!1,xmlPath:"",xmlPlaylist:"",hideOnMobile:!1, loopPlaylist:!0,storePlaylist:!1}})(jQuery);"object"!==typeof JSON&&(JSON={}); (function(){function e(e){return 10>e?"0"+e:e}function G(e){N.lastIndex=0;return N.test(e)?'"'+e.replace(N,function(e){var x=E[e];return"string"===typeof x?x:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function H(e,B){var x,A,D,M,C=z,w,p=B[e];p&&"object"===typeof p&&"function"===typeof p.toJSON&&(p=p.toJSON(e));"function"===typeof y&&(p=y.call(B,e,p));switch(typeof p){case "string":return G(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p); case "object":if(!p)return"null";z+=J;w=[];if("[object Array]"===Object.prototype.toString.apply(p)){M=p.length;for(x=0;x<M;x+=1)w[x]=H(x,p)||"null";D=0===w.length?"[]":z?"[\n"+z+w.join(",\n"+z)+"\n"+C+"]":"["+w.join(",")+"]";z=C;return D}if(y&&"object"===typeof y)for(M=y.length,x=0;x<M;x+=1)"string"===typeof y[x]&&(A=y[x],(D=H(A,p))&&w.push(G(A)+(z?": ":":")+D));else for(A in p)Object.prototype.hasOwnProperty.call(p,A)&&(D=H(A,p))&&w.push(G(A)+(z?": ":":")+D);D=0===w.length?"{}":z?"{\n"+z+w.join(",\n"+ z)+"\n"+C+"}":"{"+w.join(",")+"}";z=C;return D}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var F=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, N=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,z,J,E={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},y;"function"!==typeof JSON.stringify&&(JSON.stringify=function(e,B,x){var A;J=z="";if("number"===typeof x)for(A=0;A<x;A+=1)J+=" ";else"string"===typeof x&&(J=x);if((y=B)&&"function"!==typeof B&&("object"!==typeof B||"number"!==typeof B.length))throw Error("JSON.stringify");return H("",{"":e})}); "function"!==typeof JSON.parse&&(JSON.parse=function(e,z){function x(e,A){var y,w,p=e[A];if(p&&"object"===typeof p)for(y in p)Object.prototype.hasOwnProperty.call(p,y)&&(w=x(p,y),void 0!==w?p[y]=w:delete p[y]);return z.call(e,A,p)}var A;e=String(e);F.lastIndex=0;F.test(e)&&(e=e.replace(F,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return A=eval("("+e+")"),"function"===typeof z?x({"":A},""):A;throw new SyntaxError("JSON.parse");})})(); (function(e){var G=!1,H=!1,F=5E3,N=2E3,z=0,J,E=document.getElementsByTagName("script"),E=E[E.length-1].src.split("?")[0];J=0<E.split("/").length?E.split("/").slice(0,-1).join("/")+"/":"";Array.prototype.forEach||(Array.prototype.forEach=function(e,c){for(var m=0,r=this.length;m<r;++m)e.call(c,this[m],m,this)});var y=window.requestAnimationFrame||!1,L=window.cancelAnimationFrame||!1;["ms","moz","webkit","o"].forEach(function(e){y||(y=window[e+"RequestAnimationFrame"]);L||(L=window[e+"CancelAnimationFrame"]|| window[e+"CancelRequestAnimationFrame"])});var B=window.MutationObserver||window.WebKitMutationObserver||!1,x={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0, railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:0.3,rtlmode:!1,cursordragontouch:!1},A=!1,D=function(v,c){function m(){var d= b.win;if("zIndex"in d)return d.zIndex();for(;0<d.length&&9!=d[0].nodeType;){var c=d.css("zIndex");if(!isNaN(c)&&0!=c)return parseInt(c);d=d.parent()}return!1}function r(d,c,f){c=d.css(c);d=parseFloat(c);return isNaN(d)?(d=D[c]||0,f=3==d?f?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1,b.isie8&&d&&(d+=1),f?d:0):d}function l(d,c,f,e){b._bind(d,c,function(b){b=b?b:window.event;var e={original:b,target:b.target||b.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"== b.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){b.preventDefault?b.preventDefault():b.returnValue=!1;return!1},stopImmediatePropagation:function(){b.stopImmediatePropagation?b.stopImmediatePropagation():b.cancelBubble=!0}};"mousewheel"==c?(e.deltaY=-0.025*b.wheelDelta,b.wheelDeltaX&&(e.deltaX=-0.025*b.wheelDeltaX)):e.deltaY=b.detail;return f.call(d,e)},e)}function t(d,c,f){var e,g;0==d.deltaMode?(e=-Math.floor(d.deltaX*(b.opt.mousescrollstep/54)),g=-Math.floor(d.deltaY*(b.opt.mousescrollstep/ 54))):1==d.deltaMode&&(e=-Math.floor(d.deltaX*b.opt.mousescrollstep),g=-Math.floor(d.deltaY*b.opt.mousescrollstep));c&&0==e&&g&&(e=g,g=0);e&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=e,b.debounced("mousewheelx",function(){var d=b.lastdeltax;b.lastdeltax=0;b.rail.drag||b.doScrollLeftBy(d)},120));if(g){if(b.opt.nativeparentscrolling&&f&&!b.ispage&&!b.zoomactive)if(0>g){if(b.getScrollTop()>=b.page.maxh)return!0}else if(0>=b.getScrollTop())return!0;b.scrollmom&&b.scrollmom.stop();b.lastdeltay+=g; b.debounced("mousewheely",function(){var d=b.lastdeltay;b.lastdeltay=0;b.rail.drag||b.doScrollBy(d)},120)}d.stopImmediatePropagation();return d.preventDefault()}var b=this;this.version="3.4.0";this.name="nicescroll";this.me=c;this.opt={doc:e("body"),win:!1};e.extend(this.opt,x);this.opt.snapbackspeed=80;if(v)for(var n in b.opt)"undefined"!=typeof v[n]&&(b.opt[n]=v[n]);this.iddoc=(this.doc=b.opt.doc)&&this.doc[0]?this.doc[0].id||"":"";this.ispage=/BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName); this.haswrapper=!1!==b.opt.win;this.win=b.opt.win||(this.ispage?e(window):this.doc);this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win;this.body=e("body");this.iframe=this.isfixed=this.viewport=!1;this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName;this.istextarea="TEXTAREA"==this.win[0].nodeName;this.forcescreen=!1;this.canshowonmouseevent="scroll"!=b.opt.autohidemode;this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart= this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1;this.scroll={x:0,y:0};this.scrollratio={x:0,y:0};this.cursorheight=20;this.scrollvaluemax=0;this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.checkrtlmode=!1;do this.id="ascrail"+N++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1;this.visibility= !0;this.hidden=this.locked=!1;this.cursoractive=!0;this.overflowx=b.opt.overflowx;this.overflowy=b.opt.overflowy;this.nativescrollingarea=!1;this.checkarea=0;this.events=[];this.saved={};this.delaylist={};this.synclist={};this.lastdeltay=this.lastdeltax=0;if(A)n=A;else{n=document.createElement("DIV");var h={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};h.isopera="opera"in window;h.isopera12=h.isopera&&"getUserMedia"in navigator; h.isie="all"in document&&"attachEvent"in n&&!h.isopera;h.isieold=h.isie&&!("msInterpolationMode"in n.style);h.isie7=h.isie&&!h.isieold&&(!("documentMode"in document)||7==document.documentMode);h.isie8=h.isie&&"documentMode"in document&&8==document.documentMode;h.isie9=h.isie&&"performance"in window&&9<=document.documentMode;h.isie10=h.isie&&"performance"in window&&10<=document.documentMode;h.isie9mobile=/iemobile.9/i.test(navigator.userAgent);h.isie9mobile&&(h.isie9=!1);h.isie7mobile=!h.isie9mobile&& h.isie7&&/iemobile/i.test(navigator.userAgent);h.ismozilla="MozAppearance"in n.style;h.iswebkit="WebkitAppearance"in n.style;h.ischrome="chrome"in window;h.ischrome22=h.ischrome&&h.haspointerlock;h.ischrome26=h.ischrome&&"transition"in n.style;h.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window;h.hasmstouch=window.navigator.msPointerEnabled||!1;h.ismac=/^mac$/i.test(navigator.platform);h.isios=h.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform);h.isios4=h.isios&&!("seal"in Object);h.isandroid=/android/i.test(navigator.userAgent);h.trstyle=!1;h.hastransform=!1;h.hastranslate3d=!1;h.transitionstyle=!1;h.hastransition=!1;h.transitionend=!1;for(var p=["transform","msTransform","webkitTransform","MozTransform","OTransform"],s=0;s<p.length;s++)if("undefined"!=typeof n.style[p[s]]){h.trstyle=p[s];break}h.hastransform=!1!=h.trstyle;h.hastransform&&(n.style[h.trstyle]="translate3d(1px,2px,3px)",h.hastranslate3d=/translate3d/.test(n.style[h.trstyle]));h.transitionstyle=!1;h.prefixstyle= "";h.transitionend=!1;for(var p="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),w=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),C="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),s=0;s<p.length;s++)if(p[s]in n.style){h.transitionstyle=p[s];h.prefixstyle=w[s];h.transitionend=C[s];break}h.ischrome26&&(h.prefixstyle=w[1]);h.hastransition=h.transitionstyle;a:{p=["-moz-grab", "-webkit-grab","grab"];if(h.ischrome&&!h.ischrome22||h.isie)p=[];for(s=0;s<p.length;s++)if(w=p[s],n.style.cursor=w,n.style.cursor==w){p=w;break a}p="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}h.cursorgrabvalue=p;h.hasmousecapture="setCapture"in n;h.hasMutationObserver=!1!==B;n=null;n=A=h}this.detected=n;var g=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=g.hastransform&&b.opt.hwacceleration)&&b.haswrapper;this.istouchcapable=!1;g.cantouch&&g.ischrome&&!g.isios&& !g.isandroid&&(this.istouchcapable=!0,g.cantouch=!1);g.cantouch&&g.ismozilla&&!g.isios&&(this.istouchcapable=!0,g.cantouch=!1);b.opt.enablemouselockapi||(g.hasmousecapture=!1,g.haspointerlock=!1);this.delayed=function(d,c,f,e){var g=b.delaylist[d],h=(new Date).getTime();if(!e&&g&&g.tt)return!1;g&&g.tt&&clearTimeout(g.tt);g&&g.last+f>h&&!g.tt?b.delaylist[d]={last:h+f,tt:setTimeout(function(){b.delaylist[d].tt=0;c.call()},f)}:g&&g.tt||(b.delaylist[d]={last:h,tt:0},setTimeout(function(){c.call()},0))}; this.debounced=function(d,c,f){var e=b.delaylist[d];(new Date).getTime();b.delaylist[d]=c;e||setTimeout(function(){var c=b.delaylist[d];b.delaylist[d]=!1;c.call()},f)};this.synched=function(d,c){b.synclist[d]=c;b.onsync||(y(function(){b.onsync=!1;for(d in b.synclist){var c=b.synclist[d];c&&c.call(b);b.synclist[d]=!1}}),b.onsync=!0);return d};this.unsynched=function(d){b.synclist[d]&&(b.synclist[d]=!1)};this.css=function(d,c){for(var e in c)b.saved.css.push([d,e,d.css(e)]),d.css(e,c[e])};this.scrollTop= function(d){return"undefined"==typeof d?b.getScrollTop():b.setScrollTop(d)};this.scrollLeft=function(d){return"undefined"==typeof d?b.getScrollLeft():b.setScrollLeft(d)};BezierClass=function(b,c,e,g,h,m,q){this.st=b;this.ed=c;this.spd=e;this.p1=g||0;this.p2=h||1;this.p3=m||0;this.p4=q||1;this.ts=(new Date).getTime();this.df=this.ed-this.st};BezierClass.prototype={B2:function(b){return 3*b*b*(1-b)},B3:function(b){return 3*b*(1-b)*(1-b)},B4:function(b){return(1-b)*(1-b)*(1-b)},getNow:function(){var b= 1-((new Date).getTime()-this.ts)/this.spd,c=this.B2(b)+this.B3(b)+this.B4(b);return 0>b?this.ed:this.st+Math.round(this.df*c)},update:function(b,c){this.st=this.getNow();this.ed=b;this.spd=c;this.ts=(new Date).getTime();this.df=this.ed-this.st;return this}};if(this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"};g.hastranslate3d&&g.isios&&this.doc.css("-webkit-backface-visibility","hidden");var u=function(){var d=b.doc.css(g.trstyle);return d&&"matrix"==d.substr(0,6)?d.replace(/^.*\((.*)\)$/g, "$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(d){if(!d){if(d=u())return 16==d.length?-d[13]:-d[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y};this.getScrollLeft=function(d){if(!d){if(d=u())return 16==d.length?-d[12]:-d[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x};this.notifyScrollEvent=document.createEvent?function(b){var c=document.createEvent("UIEvents");c.initUIEvent("scroll", !1,!0,window,1);b.dispatchEvent(c)}:document.fireEvent?function(b){var c=document.createEventObject();b.fireEvent("onscroll");c.cancelBubble=!0}:function(){};g.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(d,c){b.doc.translate.y=d;b.doc.translate.ty=-1*d+"px";b.doc.css(g.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)");c||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(d,c){b.doc.translate.x=d;b.doc.translate.tx=-1*d+"px";b.doc.css(g.trstyle, "translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)");c||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(d,c){b.doc.translate.y=d;b.doc.translate.ty=-1*d+"px";b.doc.css(g.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")");c||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(d,c){b.doc.translate.x=d;b.doc.translate.tx=-1*d+"px";b.doc.css(g.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")");c||b.notifyScrollEvent(b.win[0])})}else this.getScrollTop= function(){return b.docscroll.scrollTop()},this.setScrollTop=function(d){return b.docscroll.scrollTop(d)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(d){return b.docscroll.scrollLeft(d)};this.getTarget=function(b){return b?b.target?b.target:b.srcElement?b.srcElement:!1:!1};this.hasParent=function(b,c){if(!b)return!1;for(var e=b.target||b.srcElement||b||!1;e&&e.id!=c;)e=e.parentNode||!1;return!1!==e};var D={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")), left:parseFloat(b.win.css("left"))};if(!b.viewport)return b.win.offset();var d=b.win.offset(),c=b.viewport.offset();return{top:d.top-c.top+b.viewport.scrollTop(),left:d.left-c.left+b.viewport.scrollLeft()}};this.updateScrollBar=function(d){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var c=b.getOffset(),e=c.top,g=c.left,e=e+r(b.win,"border-top-width",!0);b.win.outerWidth();b.win.innerWidth();var g=g+(b.rail.align?b.win.outerWidth()- r(b.win,"border-right-width")-b.rail.width:r(b.win,"border-left-width")),h=b.opt.railoffset;h&&(h.top&&(e+=h.top),b.rail.align&&h.left&&(g+=h.left));b.locked||b.rail.css({top:e,left:g,height:d?d.h:b.win.innerHeight()});b.zoom&&b.zoom.css({top:e+1,left:1==b.rail.align?g-20:g+b.rail.width+4});b.railh&&!b.locked&&(e=c.top,g=c.left,d=b.railh.align?e+r(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:e+r(b.win,"border-top-width",!0),g+=r(b.win,"border-left-width"),b.railh.css({top:d,left:g, width:b.railh.width}))}};this.doRailClick=function(d,c,e){var g;b.locked||(b.cancelEvent(d),c?(c=e?b.doScrollLeft:b.doScrollTop,g=e?(d.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(d.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,c(g)):(c=e?b.doScrollLeftBy:b.doScrollBy,g=e?b.scroll.x:b.scroll.y,d=e?d.pageX-b.railh.offset().left:d.pageY-b.rail.offset().top,e=e?b.view.w:b.view.h,g>=d?c(e):c(-e)))};b.hasanimationframe=y;b.hascancelanimationframe=L;b.hasanimationframe?b.hascancelanimationframe|| (L=function(){b.cancelAnimationFrame=!0}):(y=function(b){return setTimeout(b,15-Math.floor(+new Date/1E3)%16)},L=clearInterval);this.init=function(){b.saved.css=[];if(g.isie7mobile)return!0;g.hasmstouch&&b.css(b.ispage?e("html"):b.win,{"-ms-touch-action":"none"});b.zindex="auto";b.zindex=b.ispage||"auto"!=b.opt.zindex?b.opt.zindex:m()||"auto";!b.ispage&&"auto"!=b.zindex&&b.zindex>z&&(z=b.zindex);b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto");if(!b.ispage||!g.cantouch&&!g.isieold&&!g.isie9mobile){var d= b.docscroll;b.ispage&&(d=b.haswrapper?b.win:b.doc);g.isie9mobile||b.css(d,{"overflow-y":"hidden"});b.ispage&&g.isie7&&("BODY"==b.doc[0].nodeName?b.css(e("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(e("body"),{"overflow-y":"hidden"}));g.isios&&!b.ispage&&!b.haswrapper&&b.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var c=e(document.createElement("div"));c.css({position:"relative",top:0,"float":"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor, border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius});c.hborder=parseFloat(c.outerHeight()-c.innerHeight());b.cursor=c;var f=e(document.createElement("div"));f.attr("id",b.id);f.addClass("nicescroll-rails");var h,n,r=["left","right"],q;for(q in r)n=r[q],(h=b.opt.railpadding[n])?f.css("padding-"+n,h+"px"):b.opt.railpadding[n]=0;f.append(c);f.width=Math.max(parseFloat(b.opt.cursorwidth), c.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right;f.css({width:f.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"});f.visibility=!0;f.scrollable=!0;f.align="left"==b.opt.railalign?0:1;b.rail=f;c=b.rail.drag=!1;b.opt.boxzoom&&!b.ispage&&!g.isieold&&(c=document.createElement("div"),b.bind(c,"click",b.doZoom),b.zoom=e(c),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+J+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&& b.bind(b.win,"dblclick",b.doZoom),g.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(d){1.5<d.scale&&b.doZoomIn(d);0.8>d.scale&&b.doZoomOut(d);return b.cancelEvent(d)},b.bind(b.win,"gestureend",b.ongesturezoom)));b.railh=!1;if(b.opt.horizrailenabled){b.css(d,{"overflow-x":"hidden"});c=e(document.createElement("div"));c.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius, "-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius});c.wborder=parseFloat(c.outerWidth()-c.innerWidth());b.cursorh=c;var l=e(document.createElement("div"));l.attr("id",b.id+"-hr");l.addClass("nicescroll-rails");l.height=Math.max(parseFloat(b.opt.cursorwidth),c.outerHeight());l.css({height:l.height+"px",zIndex:b.zindex,background:b.opt.background});l.append(c);l.visibility=!0;l.scrollable=!0;l.align="top"==b.opt.railvalign?0:1;b.railh=l;b.railh.drag=!1}b.ispage? (f.css({position:"fixed",top:"0px",height:"100%"}),f.align?f.css({right:"0px"}):f.css({left:"0px"}),b.body.append(f),b.railh&&(l.css({position:"fixed",left:"0px",width:"100%"}),l.align?l.css({bottom:"0px"}):l.css({top:"0px"}),b.body.append(l))):(b.ishwscroll?("static"==b.win.css("position")&&b.css(b.win,{position:"relative"}),d="HTML"==b.win[0].nodeName?b.body:b.win,b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":f.width+4}),d.append(b.zoom)),f.css({position:"absolute",top:0}), f.align?f.css({right:0}):f.css({left:0}),d.append(f),l&&(l.css({position:"absolute",left:0,bottom:0}),l.align?l.css({bottom:0}):l.css({top:0}),d.append(l))):(b.isfixed="fixed"==b.win.css("position"),d=b.isfixed?"fixed":"absolute",b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,!1==/relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),f.css({position:d}),b.zoom&&b.zoom.css({position:d}),b.updateScrollBar(),b.body.append(f),b.zoom&& b.body.append(b.zoom),b.railh&&(l.css({position:d}),b.body.append(l))),g.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),g.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),g.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"}));!1===b.opt.autohidemode?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):!0===b.opt.autohidemode?(b.autohidedom=e().add(b.rail),g.isie8&& (b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&g.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=e().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=e().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1);if(g.isie9mobile)b.scrollmom=new M(b),b.onmangotouch= function(){var d=b.getScrollTop(),c=b.getScrollLeft();if(d==b.scrollmom.lastscrolly&&c==b.scrollmom.lastscrollx)return!0;var e=d-b.mangotouch.sy,k=c-b.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(k,2)+Math.pow(e,2)))){var f=0>e?-1:1,g=0>k?-1:1,h=+new Date;b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy);80<h-b.mangotouch.tm||b.mangotouch.dry!=f||b.mangotouch.drx!=g?(b.scrollmom.stop(),b.scrollmom.reset(c,d),b.mangotouch.sy=d,b.mangotouch.ly=d,b.mangotouch.sx=c,b.mangotouch.lx=c,b.mangotouch.dry= f,b.mangotouch.drx=g,b.mangotouch.tm=h):(b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-k,b.mangotouch.sy-e),b.mangotouch.tm=h,e=Math.max(Math.abs(b.mangotouch.ly-d),Math.abs(b.mangotouch.lx-c)),b.mangotouch.ly=d,b.mangotouch.lx=c,2<e&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1;b.mangotouch.dry=0;b.mangotouch.drx=0;b.mangotouch.tm=0;b.scrollmom.doMomentum(30)},100)))}},f=b.getScrollTop(),l=b.getScrollLeft(),b.mangotouch={sy:f,ly:f,dry:0,sx:l,lx:l,drx:0,lazy:!1,tm:0},b.bind(b.docscroll, "scroll",b.onmangotouch);else{if(g.cantouch||b.istouchcapable||b.opt.touchbehavior||g.hasmstouch){b.scrollmom=new M(b);b.ontouchstart=function(d){if(d.pointerType&&2!=d.pointerType)return!1;if(!b.locked){if(g.hasmstouch)for(var c=d.target?d.target:!1;c;){var k=e(c).getNiceScroll();if(0<k.length&&k[0].me==b.me)break;if(0<k.length)return!1;if("DIV"==c.nodeName&&c.id==b.id)break;c=c.parentNode?c.parentNode:!1}b.cancelScroll();if((c=b.getTarget(d))&&/INPUT/i.test(c.nodeName)&&/range/i.test(c.type))return b.stopPropagation(d); !("clientX"in d)&&"changedTouches"in d&&(d.clientX=d.changedTouches[0].clientX,d.clientY=d.changedTouches[0].clientY);b.forcescreen&&(k=d,d={original:d.original?d.original:d},d.clientX=k.screenX,d.clientY=k.screenY);b.rail.drag={x:d.clientX,y:d.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1};if(b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var k=e(window).width(),f=e(window).height(),h=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth), m=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),f=Math.max(0,m-f),k=Math.max(0,h-k);b.rail.drag.ck=!b.rail.scrollable&&b.railh.scrollable?0<f?"v":!1:b.rail.scrollable&&!b.railh.scrollable?0<k?"h":!1:!1;b.rail.drag.ck||(b.rail.drag.dl="f")}b.opt.touchbehavior&&b.isiframe&&g.isie&&(k=b.win.position(),b.rail.drag.x+=k.left,b.rail.drag.y+=k.top);b.hasmoving=!1;b.lastmouseup=!1;b.scrollmom.reset(d.clientX,d.clientY);if(!g.cantouch&&!this.istouchcapable&&!g.hasmstouch){if(!c|| !/INPUT|SELECT|TEXTAREA/i.test(c.nodeName))return!b.ispage&&g.hasmousecapture&&c.setCapture(),b.cancelEvent(d);/SUBMIT|CANCEL|BUTTON/i.test(e(c).attr("type"))&&(pc={tg:c,click:!1},b.preventclick=pc)}}};b.ontouchend=function(d){if(d.pointerType&&2!=d.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.hasmoving=!1,b.lastmouseup=!0,b.hideCursor(),g.hasmousecapture&&document.releaseCapture(),!g.cantouch)))return b.cancelEvent(d)};var p=b.opt.touchbehavior&& b.isiframe&&!g.hasmousecapture;b.ontouchmove=function(d,c){if(d.pointerType&&2!=d.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(g.cantouch&&"undefined"==typeof d.original)return!0;b.hasmoving=!0;b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick);d=e.extend({original:d},d);"changedTouches"in d&&(d.clientX=d.changedTouches[0].clientX,d.clientY=d.changedTouches[0].clientY);if(b.forcescreen){var k=d;d={original:d.original? d.original:d};d.clientX=k.screenX;d.clientY=k.screenY}k=ofy=0;if(p&&!c){var f=b.win.position(),k=-f.left;ofy=-f.top}var h=d.clientY+ofy,f=h-b.rail.drag.y,m=d.clientX+k,l=m-b.rail.drag.x,q=b.rail.drag.st-f;b.ishwscroll&&b.opt.bouncescroll?0>q?q=Math.round(q/2):q>b.page.maxh&&(q=b.page.maxh+Math.round((q-b.page.maxh)/2)):(0>q&&(h=q=0),q>b.page.maxh&&(q=b.page.maxh,h=0));if(b.railh&&b.railh.scrollable){var n=b.rail.drag.sl-l;b.ishwscroll&&b.opt.bouncescroll?0>n?n=Math.round(n/2):n>b.page.maxw&&(n=b.page.maxw+ Math.round((n-b.page.maxw)/2)):(0>n&&(m=n=0),n>b.page.maxw&&(n=b.page.maxw,m=0))}k=!1;if(b.rail.drag.dl)k=!0,"v"==b.rail.drag.dl?n=b.rail.drag.sl:"h"==b.rail.drag.dl&&(q=b.rail.drag.st);else{var f=Math.abs(f),l=Math.abs(l),r=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(f>r&&l<=0.3*f)return b.rail.drag=!1,!0;l>r&&(b.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(l>r&&f<=0.3*az)return b.rail.drag=!1,!0;f>r&&(b.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}b.synched("touchmove", function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(q),b.scrollmom.update(m,h),b.railh&&b.railh.scrollable?(b.setScrollLeft(n),b.showCursor(q,n)):b.showCursor(q),g.isie10&&document.selection.clear())});g.ischrome&&b.istouchcapable&&(k=!1);if(k)return b.cancelEvent(d)}}}b.onmousedown=function(d,c){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(d);b.cancelScroll();b.rail.drag={x:d.clientX,y:d.clientY,sx:b.scroll.x, sy:b.scroll.y,pt:1,hr:!!c};var e=b.getTarget(d);!b.ispage&&g.hasmousecapture&&e.setCapture();b.isiframe&&!g.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"}));return b.cancelEvent(d)}};b.onmouseup=function(d){if(b.rail.drag&&(g.hasmousecapture&&document.releaseCapture(),b.isiframe&&!g.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),1==b.rail.drag.pt))return b.rail.drag=!1,b.cancelEvent(d)};b.onmousemove=function(d){if(b.rail.drag&& 1==b.rail.drag.pt){if(g.ischrome&&0==d.which)return b.onmouseup(d);b.cursorfreezed=!0;if(b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(d.clientX-b.rail.drag.x);0>b.scroll.x&&(b.scroll.x=0);var c=b.scrollvaluemaxw;b.scroll.x>c&&(b.scroll.x=c)}else b.scroll.y=b.rail.drag.sy+(d.clientY-b.rail.drag.y),0>b.scroll.y&&(b.scroll.y=0),c=b.scrollvaluemax,b.scroll.y>c&&(b.scroll.y=c);b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt&&(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x* b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed))});return b.cancelEvent(d)}};if(g.cantouch||b.opt.touchbehavior)b.onpreventclick=function(d){if(b.preventclick)return b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(d)},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=g.isios?!1:function(d){return b.lastmouseup?(b.lastmouseup=!1,b.cancelEvent(d)):!0},b.opt.grabcursorenabled&&g.cursorgrabvalue&&(b.css(b.ispage? b.doc:b.win,{cursor:g.cursorgrabvalue}),b.css(b.rail,{cursor:g.cursorgrabvalue}));else{var v=function(d){if(b.selectiondrag){if(d){var c=b.win.outerHeight();d=d.pageY-b.selectiondrag.top;0<d&&d<c&&(d=0);d>=c&&(d-=c);b.selectiondrag.df=d}0!=b.selectiondrag.df&&(b.doScrollBy(2*-Math.floor(b.selectiondrag.df/6)),b.debounced("doselectionscroll",function(){v()},50))}};b.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!= document.selection.type}:function(){return!1};b.onselectionstart=function(){b.ispage||(b.selectiondrag=b.win.offset())};b.onselectionend=function(){b.selectiondrag=!1};b.onselectiondrag=function(d){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){v(d)},250)}}g.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove", b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(b){b.preventDefault()}),b.bind(b.cursor,"contextmenu",function(b){b.preventDefault()}));this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove));b.bind(b.cursor,"mousedown",b.onmousedown);b.bind(b.cursor,"mouseup",b.onmouseup);b.railh&&(b.bind(b.cursorh,"mousedown",function(d){b.onmousedown(d,!0)}),b.bind(b.cursorh, "mouseup",function(d){if(!b.rail.drag||2!=b.rail.drag.pt)return b.rail.drag=!1,b.hasmoving=!1,b.hideCursor(),g.hasmousecapture&&document.releaseCapture(),b.cancelEvent(d)}));if(b.opt.cursordragontouch||!g.cantouch&&!b.opt.touchbehavior)b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor();b.rail.active=!0}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1;b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&& (b.bind(b.rail,"click",function(d){b.doRailClick(d,!1,!1)}),b.bind(b.rail,"dblclick",function(d){b.doRailClick(d,!0,!1)}),b.bind(b.cursor,"click",function(d){b.cancelEvent(d)}),b.bind(b.cursor,"dblclick",function(d){b.cancelEvent(d)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor();b.rail.active=!0}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1;b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(d){b.doRailClick(d, !1,!0)}),b.bind(b.railh,"dblclick",function(d){b.doRailClick(d,!0,!0)}),b.bind(b.cursorh,"click",function(d){b.cancelEvent(d)}),b.bind(b.cursorh,"dblclick",function(d){b.cancelEvent(d)})));g.cantouch||b.opt.touchbehavior?(b.bind(g.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh, "mousedown",b.onmousedown),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))):(b.bind(g.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)), b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor();b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1;b.rail.drag||b.hideCursor()})));b.opt.enablemousewheel&&(b.isiframe||b.bind(g.isie&&b.ispage?document:b.docscroll,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr));b.ispage||g.cantouch||/HTML|BODY/.test(b.win[0].nodeName)||(b.win.attr("tabindex")||b.win.attr({tabindex:F++}), b.jqbind(b.win,"focus",function(d){G=b.getTarget(d).id||!0;b.hasfocus=!0;b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(){G=!1;b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(d){H=b.getTarget(d).id||!0;b.hasmousefocus=!0;b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){H=!1;b.hasmousefocus=!1}))}b.onkeypress=function(d){if(b.locked&&0==b.page.maxh)return!0;d=d?d:window.e;var c=b.getTarget(d);if(c&&/INPUT|TEXTAREA|SELECT|OPTION/.test(c.nodeName)&& (!c.getAttribute("type")&&!c.type||!/submit|button|cancel/i.tp))return!0;if(b.hasfocus||b.hasmousefocus&&!G||b.ispage&&!G&&!H){c=d.keyCode;if(b.locked&&27!=c)return b.cancelEvent(d);var e=d.ctrlKey||!1,k=d.shiftKey||!1,f=!1;switch(c){case 38:case 63233:b.doScrollBy(72);f=!0;break;case 40:case 63235:b.doScrollBy(-72);f=!0;break;case 37:case 63232:b.railh&&(e?b.doScrollLeft(0):b.doScrollLeftBy(72),f=!0);break;case 39:case 63234:b.railh&&(e?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),f=!0);break; case 33:case 63276:b.doScrollBy(b.view.h);f=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h);f=!0;break;case 36:case 63273:b.railh&&e?b.doScrollPos(0,0):b.doScrollTo(0);f=!0;break;case 35:case 63275:b.railh&&e?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh);f=!0;break;case 32:b.opt.spacebarenabled&&(k?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),f=!0);break;case 27:b.zoomactive&&(b.doZoom(),f=!0)}if(f)return b.cancelEvent(d)}};b.opt.enablekeyboard&&b.bind(document,g.isopera&& !g.isopera12?"keypress":"keydown",b.onkeypress);b.bind(window,"resize",b.lazyResize);b.bind(window,"orientationchange",b.lazyResize);b.bind(window,"load",b.lazyResize);if(g.ischrome&&!b.ispage&&!b.haswrapper){var s=b.win.attr("style"),f=parseFloat(b.win.css("width"))+1;b.win.css("width",f);b.synched("chromefix",function(){b.win.attr("style",s)})}b.onAttributeChange=function(){b.lazyResize(250)};!b.ispage&&!b.haswrapper&&(!1!==B?(b.observer=new B(function(d){d.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0], {childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new B(function(d){d.forEach(function(d){if(0<d.removedNodes.length)for(var c in d.removedNodes)if(d.removedNodes[c]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,g.isie&&!g.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),g.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved", function(d){d.target==b.win[0]&&b.remove()})));!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom);b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize);b.checkrtlmode=!0;b.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var t=function(){b.iframexd=!1;try{var d="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(c){b.iframexd=!0,d=!1}if(b.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;b.forcescreen=!0;b.isiframe&& (b.iframe={doc:e(d),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=e(b.iframe.body));if(!g.isios&&b.opt.iframeautoresize&&!b.isiframe){b.win.scrollTop(0);b.doc.height("");var k=Math.max(d.getElementsByTagName("html")[0].scrollHeight,d.body.scrollHeight);b.doc.height(k)}b.lazyResize(30);g.isie7&& b.css(e(b.iframe.html),{"overflow-y":"hidden"});b.css(e(b.iframe.body),{"overflow-y":"hidden"});"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(d,"scroll",b.onscroll);b.opt.enablemousewheel&&b.bind(d,"mousewheel",b.onmousewheel);b.opt.enablekeyboard&&b.bind(d,g.isopera?"keypress":"keydown",b.onkeypress);if(g.cantouch||b.opt.touchbehavior)b.bind(d,"mousedown",b.onmousedown),b.bind(d,"mousemove",function(d){b.onmousemove(d,!0)}),b.opt.grabcursorenabled&&g.cursorgrabvalue&& b.css(e(d.body),{cursor:g.cursorgrabvalue});b.bind(d,"mouseup",b.onmouseup);b.zoom&&(b.opt.dblclickzoom&&b.bind(d,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(d,"gestureend",b.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){t.call(b.doc[0],!1)},500);b.bind(this.doc,"load",t)}};this.showCursor=function(d,c){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0);b.rail&&(b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}), b.cursoractive=!0),b.rail.drag&&1==b.rail.drag.pt||("undefined"!=typeof d&&!1!==d&&(b.scroll.y=Math.round(1*d/b.scrollratio.y)),"undefined"!=typeof c&&(b.scroll.x=Math.round(1*c/b.scrollratio.x))),b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax}))};this.hideCursor= function(d){!b.cursortimeout&&b.rail&&b.autohidedom&&(b.cursortimeout=setTimeout(function(){b.rail.active&&b.showonmouseevent||(b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1);b.cursortimeout=0},d||b.opt.hidecursordelay))};this.noticeCursor=function(d,c,e){b.showCursor(c,e);b.rail.active||b.hideCursor(d)};this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth), h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}};this.onResize=function(d,c){if(!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&& b.hideRail().hideRailHr(),!1;b.hidden||b.visibility||b.showRail().showRailHr()}var e=b.page.maxh,g=b.page.maxw,h=b.view.w;b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)};b.page=c?c:b.getContentSize();b.page.maxh=Math.max(0,b.page.h-b.view.h);b.page.maxw=Math.max(0,b.page.w-b.view.w);if(b.page.maxh==e&&b.page.maxw==g&&b.view.w==h){if(b.ispage)return b;e=b.win.offset();if(b.lastposition&&(g=b.lastposition,g.top==e.top&&g.left== e.left))return b;b.lastposition=e}0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0;0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0;b.locked=0==b.page.maxh&&0==b.page.maxw;if(b.locked)return b.ispage||b.updateScrollBar(b.view),!1;b.hidden||b.visibility?!b.hidden&&!b.railh.visibility&& b.showRailHr():b.showRail().showRailHr();b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20);b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h)));b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight);b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w)));b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth);b.scrollvaluemax= b.view.h-b.cursorheight-b.cursor.hborder;b.railh&&(b.railh.width=0<b.page.maxh?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder);b.checkrtlmode&&b.railh&&(b.checkrtlmode=!1,b.opt.rtlmode&&0==b.scroll.x&&b.setScrollLeft(b.page.maxw));b.ispage||b.updateScrollBar(b.view);b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax};b.getScrollTop()>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)), b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor());b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y));return b};this.resize=b.onResize;this.lazyResize=function(d){d=isNaN(d)?30:d;b.delayed("resize",b.resize,d);return b};this._bind=function(d,c,e,g){b.events.push({e:d,n:c,f:e,b:g,q:!1});d.addEventListener?d.addEventListener(c,e,g||!1):d.attachEvent?d.attachEvent("on"+c,e):d["on"+c]=e};this.jqbind=function(d,c,f){b.events.push({e:d, n:c,f:f,q:!0});e(d).bind(c,f)};this.bind=function(d,c,e,h){var m="jquery"in d?d[0]:d;"mousewheel"==c?"onwheel"in b.win?b._bind(m,"wheel",e,h||!1):(d="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",l(m,d,e,h||!1),"DOMMouseScroll"==d&&l(m,"MozMousePixelScroll",e,h||!1)):m.addEventListener?(g.cantouch&&/mouseup|mousedown|mousemove/.test(c)&&b._bind(m,"mousedown"==c?"touchstart":"mouseup"==c?"touchend":"touchmove",function(b){if(b.touches){if(2>b.touches.length){var d=b.touches.length? b.touches[0]:b;d.original=b;e.call(this,d)}}else b.changedTouches&&(d=b.changedTouches[0],d.original=b,e.call(this,d))},h||!1),b._bind(m,c,e,h||!1),g.cantouch&&"mouseup"==c&&b._bind(m,"touchcancel",e,h||!1)):b._bind(m,c,function(d){(d=d||window.event||!1)&&d.srcElement&&(d.target=d.srcElement);"pageY"in d||(d.pageX=d.clientX+document.documentElement.scrollLeft,d.pageY=d.clientY+document.documentElement.scrollTop);return!1===e.call(m,d)||!1===h?b.cancelEvent(d):!0})};this._unbind=function(b,c,e,g){b.removeEventListener? b.removeEventListener(c,e,g):b.detachEvent?b.detachEvent("on"+c,e):b["on"+c]=!1};this.unbindAll=function(){for(var d=0;d<b.events.length;d++){var c=b.events[d];c.q?c.e.unbind(c.n,c.f):b._unbind(c.e,c.n,c.f,c.b)}};this.cancelEvent=function(b){b=b.original?b.original:b?b:window.event||!1;if(!b)return!1;b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation();b.preventManipulation&&b.preventManipulation();b.cancelBubble=!0;b.cancel=!0;return b.returnValue=!1};this.stopPropagation= function(b){b=b.original?b.original:b?b:window.event||!1;if(!b)return!1;if(b.stopPropagation)return b.stopPropagation();b.cancelBubble&&(b.cancelBubble=!0);return!1};this.showRail=function(){0==b.page.maxh||!b.ispage&&"none"==b.win.css("display")||(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block"));return b};this.showRailHr=function(){if(!b.railh)return b;0==b.page.maxw||!b.ispage&&"none"==b.win.css("display")||(b.railh.visibility=!0,b.railh.css("display","block"));return b};this.hideRail= function(){b.visibility=!1;b.rail.visibility=!1;b.rail.css("display","none");return b};this.hideRailHr=function(){if(!b.railh)return b;b.railh.visibility=!1;b.railh.css("display","none");return b};this.show=function(){b.hidden=!1;b.locked=!1;return b.showRail().showRailHr()};this.hide=function(){b.hidden=!0;b.locked=!0;return b.hideRail().hideRailHr()};this.toggle=function(){return b.hidden?b.show():b.hide()};this.remove=function(){b.stop();b.cursortimeout&&clearTimeout(b.cursortimeout);b.doZoomOut(); b.unbindAll();!1!==b.observer&&b.observer.disconnect();!1!==b.observerremover&&b.observerremover.disconnect();b.events=[];b.cursor&&b.cursor.remove();b.cursorh&&b.cursorh.remove();b.rail&&b.rail.remove();b.railh&&b.railh.remove();b.zoom&&b.zoom.remove();for(var d=0;d<b.saved.css.length;d++){var c=b.saved.css[d];c[0].css(c[1],"undefined"==typeof c[2]?"":c[2])}b.saved=!1;b.me.data("__nicescroll","");e.nicescroll.remove(b);for(var f in b)b[f]=null,delete b[f];b=null};this.scrollstart=function(d){this.onscrollstart= d;return b};this.scrollend=function(d){this.onscrollend=d;return b};this.scrollcancel=function(d){this.onscrollcancel=d;return b};this.zoomin=function(d){this.onzoomin=d;return b};this.zoomout=function(d){this.onzoomout=d;return b};this.isScrollable=function(b){b=b.target?b.target:b;if("OPTION"==b.nodeName)return!0;for(;b&&1==b.nodeType&&!/BODY|HTML/.test(b.nodeName);){var c=e(b),c=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(c))return b.clientHeight!=b.scrollHeight; b=b.parentNode?b.parentNode:!1}return!1};this.getViewport=function(b){for(b=b&&b.parentNode?b.parentNode:!1;b&&1==b.nodeType&&!/BODY|HTML/.test(b.nodeName);){var c=e(b),f=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(f)&&b.clientHeight!=b.scrollHeight||0<c.getNiceScroll().length)return c;b=b.parentNode?b.parentNode:!1}return!1};this.onmousewheel=function(d){if(b.locked)return!0;if(b.rail.drag)return b.cancelEvent(d);if(!b.rail.scrollable)return b.railh&&b.railh.scrollable? b.onmousewheelhr(d):!0;var c=+new Date,e=!1;b.opt.preservenativescrolling&&b.checkarea+600<c&&(b.nativescrollingarea=b.isScrollable(d),e=!0);b.checkarea=c;if(b.nativescrollingarea)return!0;if(d=t(d,!1,e))b.checkarea=0;return d};this.onmousewheelhr=function(d){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(d);var c=+new Date,e=!1;b.opt.preservenativescrolling&&b.checkarea+600<c&&(b.nativescrollingarea=b.isScrollable(d),e=!0);b.checkarea=c;return b.nativescrollingarea? !0:b.locked?b.cancelEvent(d):t(d,!0,e)};this.stop=function(){b.cancelScroll();b.scrollmon&&b.scrollmon.stop();b.cursorfreezed=!1;b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y));b.noticeCursor();return b};this.getTransitionSpeed=function(d){var c=Math.round(10*b.opt.scrollspeed);d=Math.min(c,Math.round(d/20*b.opt.scrollspeed));return 20<d?d:0};b.opt.smoothscroll?b.ishwscroll&&g.hastransition&&b.opt.usetransition?(this.prepareTransition=function(d,c){var e=c?20<d?d:0:b.getTransitionSpeed(d), h=e?g.prefixstyle+"transform "+e+"ms ease-out":"";b.lasttransitionstyle&&b.lasttransitionstyle==h||(b.lasttransitionstyle=h,b.doc.css(g.transitionstyle,h));return e},this.doScrollLeft=function(d,c){var e=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(d,e,c)},this.doScrollTop=function(d,c){var e=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(e,d,c)},this.doScrollPos=function(d,c,e){var h=b.getScrollTop(),m=b.getScrollLeft();(0>(b.newscrolly-h)*(c-h)||0>(b.newscrollx-m)*(d- m))&&b.cancelScroll();!1==b.opt.bouncescroll&&(0>c?c=0:c>b.page.maxh&&(c=b.page.maxh),0>d?d=0:d>b.page.maxw&&(d=b.page.maxw));if(b.scrollrunning&&d==b.newscrollx&&c==b.newscrolly)return!1;b.newscrolly=c;b.newscrollx=d;b.newscrollspeed=e||!1;if(b.timer)return!1;b.timer=setTimeout(function(){var e=b.getScrollTop(),f=b.getScrollLeft(),h,m;h=d-f;m=c-e;h=Math.round(Math.sqrt(Math.pow(h,2)+Math.pow(m,2)));h=b.newscrollspeed&&1<b.newscrollspeed?b.newscrollspeed:b.getTransitionSpeed(h);b.newscrollspeed&& 1>=b.newscrollspeed&&(h*=b.newscrollspeed);b.prepareTransition(h,!0);b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm);0<h&&(!b.scrollrunning&&b.onscrollstart&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:f,y:e},request:{x:d,y:c},end:{x:b.newscrollx,y:b.newscrolly},speed:h}),g.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,g.transitionend,b.onScrollEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollEnd, h)),b.timerscroll={bz:new BezierClass(e,b.newscrolly,h,0,0,0.58,1),bh:new BezierClass(f,b.newscrollx,h,0,0,0.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60)));b.synched("doScroll-set",function(){b.timer=0;b.scrollendtrapped&&(b.scrollrunning=!0);b.setScrollTop(b.newscrolly);b.setScrollLeft(b.newscrollx);if(!b.scrollendtrapped)b.onScrollEnd()})},50)},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var d=b.getScrollTop(), c=b.getScrollLeft();b.scrollrunning=!1;g.transitionend||clearTimeout(g.transitionend);b.scrollendtrapped=!1;b._unbind(b.doc,g.transitionend,b.onScrollEnd);b.prepareTransition(0);b.setScrollTop(d);b.railh&&b.setScrollLeft(c);b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm);b.timerscroll=!1;b.cursorfreezed=!1;b.showCursor(d,c);return b},this.onScrollEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,g.transitionend,b.onScrollEnd);b.scrollendtrapped=!1;b.prepareTransition(0);b.timerscroll&& b.timerscroll.tm&&clearInterval(b.timerscroll.tm);b.timerscroll=!1;var d=b.getScrollTop(),c=b.getScrollLeft();b.setScrollTop(d);b.railh&&b.setScrollLeft(c);b.noticeCursor(!1,d,c);b.cursorfreezed=!1;0>d?d=0:d>b.page.maxh&&(d=b.page.maxh);0>c?c=0:c>b.page.maxw&&(c=b.page.maxw);if(d!=b.newscrolly||c!=b.newscrollx)return b.doScrollPos(c,d,b.opt.snapbackspeed);b.onscrollend&&b.scrollrunning&&b.onscrollend.call(b,{type:"scrollend",current:{x:c,y:d},end:{x:b.newscrollx,y:b.newscrolly}});b.scrollrunning= !1}):(this.doScrollLeft=function(c,e){var f=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(c,f,e)},this.doScrollTop=function(c,e){var f=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(f,c,e)},this.doScrollPos=function(c,e,f){function g(){if(b.cancelAnimationFrame)return!0;b.scrollrunning=!0;if(v=1-v)return b.timer=y(g)||1;var c=0,d=sy=b.getScrollTop();if(b.dst.ay){var d=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly,e=d-sy;if(0>e&&d<b.newscrolly||0<e&&d>b.newscrolly)d= b.newscrolly;b.setScrollTop(d);d==b.newscrolly&&(c=1)}else c=1;var f=sx=b.getScrollLeft();if(b.dst.ax){f=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx;e=f-sx;if(0>e&&f<b.newscrollx||0<e&&f>b.newscrollx)f=b.newscrollx;b.setScrollLeft(f);f==b.newscrollx&&(c+=1)}else c+=1;2==c?(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,0>d?d=0:d>b.page.maxh&&(d=b.page.maxh),0>f?f=0:f>b.page.maxw&&(f=b.page.maxw),f!=b.newscrollx||d!=b.newscrolly?b.doScrollPos(f,d):b.onscrollend&&b.onscrollend.call(b, {type:"scrollend",current:{x:sx,y:sy},end:{x:b.newscrollx,y:b.newscrolly}})):b.timer=y(g)||1}e="undefined"==typeof e||!1===e?b.getScrollTop(!0):e;if(b.timer&&b.newscrolly==e&&b.newscrollx==c)return!0;b.timer&&L(b.timer);b.timer=0;var h=b.getScrollTop(),m=b.getScrollLeft();(0>(b.newscrolly-h)*(e-h)||0>(b.newscrollx-m)*(c-m))&&b.cancelScroll();b.newscrolly=e;b.newscrollx=c;b.bouncescroll&&b.rail.visibility||(0>b.newscrolly?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh));b.bouncescroll&& b.railh.visibility||(0>b.newscrollx?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw));b.dst={};b.dst.x=c-m;b.dst.y=e-h;b.dst.px=m;b.dst.py=h;var l=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/l;b.dst.ay=b.dst.y/l;var n=0,r=l;0==b.dst.x?(n=h,r=e,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(n=m,r=c,b.dst.ax=1,b.dst.px=0);l=b.getTransitionSpeed(l);f&&1>=f&&(l*=f);b.bzscroll=0<l?b.bzscroll?b.bzscroll.update(r,l):new BezierClass(n,r,l,0,1,0,1):!1;if(!b.timer){(h== b.page.maxh&&e>=b.page.maxh||m==b.page.maxw&&c>=b.page.maxw)&&b.checkContentSize();var v=1;b.cancelAnimationFrame=!1;b.timer=1;b.onscrollstart&&!b.scrollrunning&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:m,y:h},request:{x:c,y:e},end:{x:b.newscrollx,y:b.newscrolly},speed:l});g();(h==b.page.maxh&&e>=h||m==b.page.maxw&&c>=m)&&b.checkContentSize();b.noticeCursor()}},this.cancelScroll=function(){b.timer&&L(b.timer);b.timer=0;b.bzscroll=!1;b.scrollrunning=!1;return b}):(this.doScrollLeft=function(c, e){var f=b.getScrollTop();b.doScrollPos(c,f,e)},this.doScrollTop=function(c,e){var f=b.getScrollLeft();b.doScrollPos(f,c,e)},this.doScrollPos=function(c,e){var f=c>b.page.maxw?b.page.maxw:c;0>f&&(f=0);var g=e>b.page.maxh?b.page.maxh:e;0>g&&(g=0);b.synched("scroll",function(){b.setScrollTop(g);b.setScrollLeft(f)})},this.cancelScroll=function(){});this.doScrollBy=function(c,e){var f=0,f=e?Math.floor((b.scroll.y-c)*b.scrollratio.y):(b.timer?b.newscrolly:b.getScrollTop(!0))-c;if(b.bouncescroll){var g= Math.round(b.view.h/2);f<-g?f=-g:f>b.page.maxh+g&&(f=b.page.maxh+g)}b.cursorfreezed=!1;py=b.getScrollTop(!0);if(0>f&&0>=py)return b.noticeCursor();if(f>b.page.maxh&&py>=b.page.maxh)return b.checkContentSize(),b.noticeCursor();b.doScrollTop(f)};this.doScrollLeftBy=function(c,e){var f=0,f=e?Math.floor((b.scroll.x-c)*b.scrollratio.x):(b.timer?b.newscrollx:b.getScrollLeft(!0))-c;if(b.bouncescroll){var g=Math.round(b.view.w/2);f<-g?f=-g:f>b.page.maxw+g&&(f=b.page.maxw+g)}b.cursorfreezed=!1;px=b.getScrollLeft(!0); if(0>f&&0>=px||f>b.page.maxw&&px>=b.page.maxw)return b.noticeCursor();b.doScrollLeft(f)};this.doScrollTo=function(c,e){e&&Math.round(c*b.scrollratio.y);b.cursorfreezed=!1;b.doScrollTop(c)};this.checkContentSize=function(){var c=b.getContentSize();c.h==b.page.h&&c.w==b.page.w||b.resize(!1,c)};b.onscroll=function(){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y));b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))); b.noticeCursor()})};b.bind(b.docscroll,"scroll",b.onscroll);this.doZoomIn=function(c){if(!b.zoomactive){b.zoomactive=!0;b.zoomrestore={style:{}};var h="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),f=b.win[0].style,m;for(m in h){var l=h[m];b.zoomrestore.style[l]="undefined"!=typeof f[l]?f[l]:""}b.zoomrestore.style.width=b.win.css("width");b.zoomrestore.style.height=b.win.css("height");b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()- b.win.height()};g.isios4&&(b.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0));b.win.css({position:g.isios4?"absolute":"fixed",top:0,left:0,"z-index":z+100,margin:"0px"});h=b.win.css("backgroundColor");(""==h||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(h))&&b.win.css("backgroundColor","#fff");b.rail.css({"z-index":z+101});b.zoom.css({"z-index":z+102});b.zoom.css("backgroundPosition","0px -18px");b.resizeZoom();b.onzoomin&&b.onzoomin.call(b);return b.cancelEvent(c)}};this.doZoomOut= function(c){if(b.zoomactive)return b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),g.isios4&&e(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(c)};this.doZoom=function(c){return b.zoomactive?b.doZoomOut(c):b.doZoomIn(c)};this.resizeZoom=function(){if(b.zoomactive){var c=b.getScrollTop();b.win.css({width:e(window).width()- b.zoomrestore.padding.w+"px",height:e(window).height()-b.zoomrestore.padding.h+"px"});b.onResize();b.setScrollTop(Math.min(b.page.maxh,c))}};this.init();e.nicescroll.push(this)},M=function(e){var c=this;this.nc=e;this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0;this.snapy=this.snapx=!1;this.demuly=this.demulx=0;this.lastscrolly=this.lastscrollx=-1;this.timer=this.chky=this.chkx=0;this.time=function(){return+new Date};this.reset=function(e,r){c.stop();var l=c.time();c.steptime= 0;c.lasttime=l;c.speedx=0;c.speedy=0;c.lastx=e;c.lasty=r;c.lastscrollx=-1;c.lastscrolly=-1};this.update=function(e,r){var l=c.time();c.steptime=l-c.lasttime;c.lasttime=l;var l=r-c.lasty,v=e-c.lastx,b=c.nc.getScrollTop(),n=c.nc.getScrollLeft(),b=b+l,n=n+v;c.snapx=0>n||n>c.nc.page.maxw;c.snapy=0>b||b>c.nc.page.maxh;c.speedx=v;c.speedy=l;c.lastx=e;c.lasty=r};this.stop=function(){c.nc.unsynched("domomentum2d");c.timer&&clearTimeout(c.timer);c.timer=0;c.lastscrollx=-1;c.lastscrolly=-1};this.doSnapy=function(e, r){var l=!1;0>r?(r=0,l=!0):r>c.nc.page.maxh&&(r=c.nc.page.maxh,l=!0);0>e?(e=0,l=!0):e>c.nc.page.maxw&&(e=c.nc.page.maxw,l=!0);l&&c.nc.doScrollPos(e,r,c.nc.opt.snapbackspeed)};this.doMomentum=function(e){var r=c.time(),l=e?r+e:c.lasttime;e=c.nc.getScrollLeft();var v=c.nc.getScrollTop(),b=c.nc.page.maxh,n=c.nc.page.maxw;c.speedx=0<n?Math.min(60,c.speedx):0;c.speedy=0<b?Math.min(60,c.speedy):0;l=l&&50>=r-l;if(0>v||v>b||0>e||e>n)l=!1;e=c.speedx&&l?c.speedx:!1;if(c.speedy&&l&&c.speedy||e){var h=Math.max(16, c.steptime);50<h&&(e=h/50,c.speedx*=e,c.speedy*=e,h=50);c.demulxy=0;c.lastscrollx=c.nc.getScrollLeft();c.chkx=c.lastscrollx;c.lastscrolly=c.nc.getScrollTop();c.chky=c.lastscrolly;var p=c.lastscrollx,s=c.lastscrolly,w=function(){var e=600<c.time()-r?0.04:0.02;c.speedx&&(p=Math.floor(c.lastscrollx-c.speedx*(1-c.demulxy)),c.lastscrollx=p,0>p||p>n)&&(e=0.1);c.speedy&&(s=Math.floor(c.lastscrolly-c.speedy*(1-c.demulxy)),c.lastscrolly=s,0>s||s>b)&&(e=0.1);c.demulxy=Math.min(1,c.demulxy+e);c.nc.synched("domomentum2d", function(){c.speedx&&(c.nc.getScrollLeft()!=c.chkx&&c.stop(),c.chkx=p,c.nc.setScrollLeft(p));c.speedy&&(c.nc.getScrollTop()!=c.chky&&c.stop(),c.chky=s,c.nc.setScrollTop(s));c.timer||(c.nc.hideCursor(),c.doSnapy(p,s))});1>c.demulxy?c.timer=setTimeout(w,h):(c.stop(),c.nc.hideCursor(),c.doSnapy(p,s))};w()}else c.doSnapy(c.nc.getScrollLeft(),c.nc.getScrollTop())}},C=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(p){var c=e.data(p,"__nicescroll")||!1;return c&&c.ishwscroll?c.getScrollTop():C.call(p)}, set:function(p,c){var m=e.data(p,"__nicescroll")||!1;m&&m.ishwscroll?m.setScrollTop(parseInt(c)):C.call(p,c);return this}};e.fn.scrollTop=function(p){if("undefined"==typeof p){var c=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return c&&c.ishwscroll?c.getScrollTop():C.call(this)}return this.each(function(){var c=e.data(this,"__nicescroll")||!1;c&&c.ishwscroll?c.setScrollTop(parseInt(p)):C.call(e(this),p)})};var w=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(p){var c=e.data(p,"__nicescroll")|| !1;return c&&c.ishwscroll?c.getScrollLeft():w.call(p)},set:function(p,c){var m=e.data(p,"__nicescroll")||!1;m&&m.ishwscroll?m.setScrollLeft(parseInt(c)):w.call(p,c);return this}};e.fn.scrollLeft=function(p){if("undefined"==typeof p){var c=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return c&&c.ishwscroll?c.getScrollLeft():w.call(this)}return this.each(function(){var c=e.data(this,"__nicescroll")||!1;c&&c.ishwscroll?c.setScrollLeft(parseInt(p)):w.call(e(this),p)})};for(var p=function(p){var c=this; this.length=0;this.name="nicescrollarray";this.each=function(e){for(var l=0,m=0;m<c.length;m++)e.call(c[m],l++);return c};this.push=function(e){c[c.length]=e;c.length++};this.remove=function(e){c.each(function(l){this.id===e.id&&(delete c[l],c.length--)})};this.eq=function(e){return c[e]};if(p)for(a=0;a<p.length;a++){var m=e.data(p[a],"__nicescroll")||!1;m&&(this[this.length]=m,this.length++)}return this},E=p.prototype,T="show hide toggle onResize resize remove stop doScrollPos".split(" "),U=function(e, c){e[c]=function(){var e=arguments;return this.each(function(){this[c].apply(this,e)})}},Q=0;Q<T.length;Q++)U(E,T[Q]);e.fn.getNiceScroll=function(v){return"undefined"==typeof v?new p(this):e.data(this[v],"__nicescroll")||!1};e.extend(e.expr[":"],{nicescroll:function(p){return e.data(p,"__nicescroll")?!0:!1}});e.fn.niceScroll=function(v,c){"undefined"==typeof c&&"object"==typeof v&&!("jquery"in v)&&(c=v,v=!1);var m=new p;"undefined"==typeof c&&(c={});v&&(c.doc=e(v),c.win=e(this));var r=!("doc"in c); r||"win"in c||(c.win=e(this));this.each(function(){var l=e(this).data("__nicescroll")||!1;l||(c.doc=r?e(this):c.doc,l=new D(c,e(this)),e(this).data("__nicescroll",l));m.push(l)});return 1==m.length?m[0]:m};window.NiceScroll={getjQuery:function(){return e}};e.nicescroll||(e.nicescroll=new p,e.nicescroll.options=x)})(jQuery);
